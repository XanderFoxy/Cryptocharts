<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Meine Bitget Futures Charts</title>
<script src="https://s3.tradingview.com/tv.js"></script>
<style>
  body {margin:0; background:#0f1720; color:white; font-family:sans-serif;}
  header {padding:16px; font-size:16px; font-weight:700;}
  .grid {display:grid; grid-template-columns:1fr 1fr; gap:12px; padding:12px;}
  @media(max-width:900px){.grid{grid-template-columns:1fr;}}
  .chart-box {position:relative; min-height:300px; background:#0b1220; border-radius:8px; overflow:hidden;}
  iframe, .widget {width:100%; height:100%; border:0;}
  .overlay-error {
    position:absolute; top:0; left:0; right:0; bottom:0;
    background:rgba(0,0,0,0.7); color:#f66666;
    display:flex; align-items:center; justify-content:center;
    font-size:16px; padding:20px; text-align:center;
    visibility:hidden;
  }
  .error-visible {visibility:visible;}
</style>
</head>
<body>
<header>Meine Bitget Futures Charts</header>
<div class="grid">
  <div class="chart-box" id="box-eth">
    <iframe id="iframe-eth"
      src="https://www.tradingview.com/chart/9aW8uzX9/?symbol=BITGET:ETHUSDT_PERP">
    </iframe>
    <div class="overlay-error" id="err-eth">iFrame konnte nicht geladen — zeige öffentliches Chart.</div>
    <div class="widget" id="widget-eth"></div>
  </div>

  <div class="chart-box" id="box-near">
    <iframe id="iframe-near"
      src="https://www.tradingview.com/chart/9aW8uzX9/?symbol=BITGET:NEARUSDT.P">
    </iframe>
    <div class="overlay-error" id="err-near">iFrame konnte nicht geladen — zeige öffentliches Chart.</div>
    <div class="widget" id="widget-near"></div>
  </div>

  <div class="chart-box" id="box-link">
    <iframe id="iframe-link"
      src="https://www.tradingview.com/chart/9aW8uzX9/?symbol=BITGET:LINKUSDT.P">
    </iframe>
    <div class="overlay-error" id="err-link">iFrame konnte nicht geladen — zeige öffentliches Chart.</div>
    <div class="widget" id="widget-link"></div>
  </div>

  <div class="chart-box" id="box-btc">
    <iframe id="iframe-btc"
      src="https://www.tradingview.com/chart/9aW8uzX9/?symbol=BITGET:BTCUSDT_PERP">
    </iframe>
    <div class="overlay-error" id="err-btc">iFrame konnte nicht geladen — zeige öffentliches Chart.</div>
    <div class="widget" id="widget-btc"></div>
  </div>
</div>

<script>
function createFallbackWidget(containerId,symbol){
  new TradingView.widget({
    container_id: containerId,
    autosize:true,
    symbol:symbol,
    interval:"60",
    timezone:"Europe/Berlin",
    theme:"dark",
    style:"1",
    locale:"de",
    toolbar_bg:"#0b1220",
    allow_symbol_change:true,
    studies:["MACD@tv-basicstudies","RSI@tv-basicstudies"]
  });
}

function setupChart(iframeId, errDivId, widgetDivId, fallbackSymbol){
  const iframe=document.getElementById(iframeId);
  const errDiv=document.getElementById(errDivId);
  const widgetDiv=document.getElementById(widgetDivId);

  iframe.addEventListener('load',()=>{
    try{
      const doc=iframe.contentWindow.document;
      if(!doc || doc.title==='' || doc.body.innerHTML.length<10){
        throw new Error('Empty or blocked');
      }
      widgetDiv.style.display='none';
    }catch(e){
      iframe.style.display='none';
      errDiv.classList.add('error-visible');
      createFallbackWidget(widgetDivId,fallbackSymbol);
    }
  });

  iframe.addEventListener('error',()=>{
    iframe.style.display='none';
    errDiv.classList.add('error-visible');
    createFallbackWidget(widgetDivId,fallbackSymbol);
  });
}

setupChart('iframe-eth','err-eth','widget-eth','BITGET:ETHUSDT_PERP');
setupChart('iframe-near','err-near','widget-near','BITGET:NEARUSDT.P');
setupChart('iframe-link','err-link','widget-link','BITGET:LINKUSDT.P');
setupChart('iframe-btc','err-btc','widget-btc','BITGET:BTCUSDT_PERP');
</script>
</body>
</html>
